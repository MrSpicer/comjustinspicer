@using Comjustinspicer.CMS.Data.Models
@model PageDTO

@{
    var isNew = Model.Id == Guid.Empty;
    ViewData["Title"] = isNew ? "Create Page" : "Edit Page";
}

<section class="section">
    <div class="container">
        <nav class="breadcrumb" aria-label="breadcrumbs">
            <ul>
                <li><a asp-controller="AdminPage" asp-action="Pages">Pages</a></li>
                <li class="is-active"><a href="#" aria-current="page">@(isNew ? "Create" : "Edit")</a></li>
            </ul>
        </nav>

        <h1 class="title">@ViewData["Title"]</h1>

        <form asp-controller="AdminPage" asp-action="SavePage" method="post" id="pageForm"
              data-controller="@Model.ControllerName"
              data-config="@Html.Raw(Model.ConfigurationJson)">
            @Html.AntiForgeryToken()

            <form-fields for="@Model" />

            <div class="field">
                <label class="label">Page Controller</label>
                <div class="control">
                    <div class="select is-fullwidth">
                        <select name="ControllerName" id="controllerSelect" required>
                            <option value="">-- Select a controller --</option>
                        </select>
                    </div>
                </div>
                <p class="help">The page type determines what the page renders and what configuration options are available.</p>
                <span asp-validation-for="ControllerName" class="has-text-danger"></span>
            </div>

            <div id="configurationArea" style="display:none;">
                <h2 class="subtitle mt-4">Configuration</h2>
                <div id="configFields"></div>
            </div>

            <div class="field is-grouped mt-4">
                <div class="control">
                    <button class="button is-primary" type="submit">Save</button>
                </div>
                <div class="control">
                    <a asp-controller="AdminPage" asp-action="Pages" class="button">Cancel</a>
                </div>
            </div>
        </form>
    </div>
</section>

<script src="~/_content/Comjustinspicer.CMS/js/page-upsert.js"></script>
