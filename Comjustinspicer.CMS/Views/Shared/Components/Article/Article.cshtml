@model Comjustinspicer.CMS.Models.Article.ArticleViewModel

@using Comjustinspicer.CMS.Services;

@inject UserService UserService

@{
    if (Model == null)
    {
        <div class="notification is-warning">Article not found.</div>
        return;
    }

    // Build slug-based detail link from the current page route
    var pageData = Context.Items["CMS:PageData"] as Comjustinspicer.CMS.Data.Models.PageDTO;
    var pageRoute = pageData?.Route?.TrimEnd('/') ?? "";
    var articleSlug = (Model.Slug ?? Model.Id?.ToString() ?? "").TrimStart('/');
    var detailLink = $"{pageRoute}/{articleSlug}";

    var listSlug = ViewData["ArticleListSlug"] as string ?? "";
}

<div class="column is-full">
	<div class="card">
		<div class="card-content">
			<p class="title">
				<a href="@detailLink">@Model.Title</a>
			</p>
			<p class="subtitle">@Model.PublicationDate?.ToString("MMMM dd, yyyy")</p>
			<hr />
			@Html.Raw(Model.Body)
		</div>
	</div>
</div>
