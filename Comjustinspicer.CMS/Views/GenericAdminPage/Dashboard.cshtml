@model Comjustinspicer.CMS.Controllers.GenericPageConfiguration

@using Comjustinspicer.CMS.Data.Services
@inject IPageService PageService
@inject IContentService<ArticleDTO> ArticleService
@inject IContentService<ContentBlockDTO> ContentBlockService
@inject IContentZoneService ContentZoneService

@{
    ViewData["Title"] = "Dashboard";
    Layout = "~/Views/Shared/_AdminLayout.cshtml";

    var allPages         = await PageService.GetAllAsync();
    var allArticles      = await ArticleService.GetAllAsync();
    var allContentBlocks = await ContentBlockService.GetAllAsync();
    var allZones         = await ContentZoneService.GetAllAsync();

    var totalPages     = allPages.Count;
    var publishedPages = allPages.Count(p => p.IsPublished);
    var draftPages     = allPages.Count(p => !p.IsPublished);
    var totalArticles  = allArticles.Count;
    var totalBlocks    = allContentBlocks.Count;
    var totalZones     = allZones.Count;

    var recentPages    = allPages.OrderByDescending(p => p.ModificationDate).Take(8).ToList();
    var recentArticles = allArticles.OrderByDescending(a => a.ModificationDate).Take(5).ToList();
}

@* @if (!string.IsNullOrWhiteSpace(Model.Meta))
{
    @section Meta {
        @Html.Raw(Model.Meta)
    }
}

@if (!string.IsNullOrWhiteSpace(Model.Style))
{
    @section Styles {
        <style>
            @Html.Raw(Model.Style)
        </style>
    }
} *@

<section class="section">
    <div class="container">

        @* Page Header *@
        <div class="level mb-5">
            <div class="level-left">
                <div>
                    <h1 class="title">Dashboard</h1>
                    <p class="subtitle">Welcome to the CMS!</p>
                </div>
            </div>
            <div class="level-right">
                <a href="/" target="_blank" class="button is-light">
                    <span class="icon"><i class="fas fa-external-link-alt"></i></span>
                    <span>View Site</span>
                </a>
            </div>
        </div>

        @* Stats Row *@
        <div class="columns mb-5">
            <div class="column">
                <div class="box">
                    <div class="level is-mobile">
                        <div class="level-left">
                            <div>
                                <p class="heading">Pages</p>
                                <p class="title">@totalPages</p>
                                <div class="tags mt-2">
                                    <span class="tag is-success">@publishedPages published</span>
                                    <span class="tag is-warning">@draftPages draft</span>
                                </div>
                            </div>
                        </div>
                        <div class="level-right">
                            <span class="icon is-large has-text-info">
                                <i class="fas fa-2x fa-file-alt"></i>
                            </span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="column">
                <div class="box">
                    <div class="level is-mobile">
                        <div class="level-left">
                            <div>
                                <p class="heading">Articles</p>
                                <p class="title">@totalArticles</p>
                            </div>
                        </div>
                        <div class="level-right">
                            <span class="icon is-large has-text-success">
                                <i class="fas fa-2x fa-newspaper"></i>
                            </span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="column">
                <div class="box">
                    <div class="level is-mobile">
                        <div class="level-left">
                            <div>
                                <p class="heading">Content Blocks</p>
                                <p class="title">@totalBlocks</p>
                            </div>
                        </div>
                        <div class="level-right">
                            <span class="icon is-large has-text-warning">
                                <i class="fas fa-2x fa-cubes"></i>
                            </span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="column">
                <div class="box">
                    <div class="level is-mobile">
                        <div class="level-left">
                            <div>
                                <p class="heading">Content Zones</p>
                                <p class="title">@totalZones</p>
                            </div>
                        </div>
                        <div class="level-right">
                            <span class="icon is-large has-text-danger">
                                <i class="fas fa-2x fa-layer-group"></i>
                            </span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        @* Two-column section: Recent Pages + Quick Actions *@
        <div class="columns mb-5">
            <div class="column is-8">
                <div class="card">
                    <div class="card-header">
                        <p class="card-header-title">Recent Pages</p>
                    </div>
                    <div class="card-content p-0">
                        @if (!recentPages.Any())
                        {
                            <div class="notification is-info m-4">
                                No pages yet. <a asp-controller="AdminContent" asp-action="Create" asp-route-contentType="pages">Create your first page</a>.
                            </div>
                        }
                        else
                        {
                            <table class="table is-fullwidth is-striped is-hoverable">
                                <thead>
                                    <tr>
                                        <th>Title</th>
                                        <th>Route</th>
                                        <th>Status</th>
                                        <th>Modified</th>
                                        <th></th>
                                    </tr>
                                </thead>
                                <tbody>
                                    @foreach (var p in recentPages)
                                    {
                                        <tr>
                                            <td>@p.Title</td>
                                            <td><code>@p.Route</code></td>
                                            <td>
                                                @if (p.IsPublished)
                                                {
                                                    <span class="tag is-success">Published</span>
                                                }
                                                else
                                                {
                                                    <span class="tag is-warning">Draft</span>
                                                }
                                            </td>
                                            <td>@p.ModificationDate.ToString("MMM d, yyyy")</td>
                                            <td>
                                                <div class="buttons are-small">
                                                    <a href="@p.Route" target="_blank" class="button is-info is-light">View</a>
                                                    <a asp-controller="AdminContent" asp-action="Edit" asp-route-contentType="pages" asp-route-id="@p.Id" class="button is-light">Edit</a>
                                                </div>
                                            </td>
                                        </tr>
                                    }
                                </tbody>
                            </table>
                        }
                    </div>
                    <div class="card-footer">
                        <a href="/admin/pages" class="card-footer-item">View all pages</a>
                    </div>
                </div>
            </div>

            <div class="column is-4">
                <div class="card">
                    <div class="card-header">
                        <p class="card-header-title">Quick Actions</p>
                    </div>
                    <div class="card-content">
                        <aside class="menu">
                            <p class="menu-label">Create New</p>
                            <ul class="menu-list">
                                <li>
                                    <a asp-controller="AdminContent" asp-action="Create" asp-route-contentType="pages">
                                        <span class="icon-text">
                                            <span class="icon"><i class="fas fa-plus"></i></span>
                                            <span>New Page</span>
                                        </span>
                                    </a>
                                </li>
                                <li>
                                    <a asp-controller="AdminContent" asp-action="Create" asp-route-contentType="contentblocks">
                                        <span class="icon-text">
                                            <span class="icon"><i class="fas fa-plus"></i></span>
                                            <span>New Content Block</span>
                                        </span>
                                    </a>
                                </li>
                            </ul>
                            <p class="menu-label">Manage</p>
                            <ul class="menu-list">
                                <li><a href="/admin/pages"><span class="icon-text"><span class="icon"><i class="fas fa-file-alt"></i></span><span>Pages</span></span></a></li>
                                <li><a href="/admin/articles"><span class="icon-text"><span class="icon"><i class="fas fa-newspaper"></i></span><span>Articles</span></span></a></li>
                                <li><a href="/admin/contentblocks"><span class="icon-text"><span class="icon"><i class="fas fa-cubes"></i></span><span>Content Blocks</span></span></a></li>
                                <li><a href="/admin/contentzones"><span class="icon-text"><span class="icon"><i class="fas fa-layer-group"></i></span><span>Content Zones</span></span></a></li>
                            </ul>
                        </aside>
                    </div>
                </div>
            </div>
        </div>

        @* Recent Articles *@
        <div class="card mb-5">
            <div class="card-header">
                <p class="card-header-title">Recent Articles</p>
            </div>
            <div class="card-content p-0">
                @if (!recentArticles.Any())
                {
                    <div class="notification is-info m-4">
                        No articles yet. <a href="/admin/articles">Manage articles</a>.
                    </div>
                }
                else
                {
                    <table class="table is-fullwidth is-striped is-hoverable">
                        <thead>
                            <tr>
                                <th>Title</th>
                                <th>Author</th>
                                <th>Status</th>
                                <th>Modified</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var article in recentArticles)
                            {
                                <tr>
                                    <td>@article.Title</td>
                                    <td>
                                        @if (string.IsNullOrWhiteSpace(article.AuthorName))
                                        {
                                            <span class="has-text-grey-light is-italic">â€”</span>
                                        }
                                        else
                                        {
                                            <span class="icon-text">
                                                <span class="icon"><i class="fas fa-user"></i></span>
                                                <span>@article.AuthorName</span>
                                            </span>
                                        }
                                    </td>
                                    <td>
                                        @if (article.IsPublished)
                                        {
                                            <span class="tag is-success">Published</span>
                                        }
                                        else
                                        {
                                            <span class="tag is-warning">Draft</span>
                                        }
                                    </td>
                                    <td>@article.ModificationDate.ToString("MMM d, yyyy")</td>
                                </tr>
                            }
                        </tbody>
                    </table>
                }
            </div>
            <div class="card-footer">
                <a href="/admin/articles" class="card-footer-item">View all articles</a>
            </div>
        </div>

    </div>
</section>

@await Component.InvokeAsync("ContentZone", new { zoneName = "Main" })

@* @if (!string.IsNullOrWhiteSpace(Model.Script))
{
    @section Scripts {
        <script>
            @Html.Raw(Model.Script)
        </script>
    }
} *@
